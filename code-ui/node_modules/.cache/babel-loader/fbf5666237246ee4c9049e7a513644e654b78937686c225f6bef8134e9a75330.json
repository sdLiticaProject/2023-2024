{"ast":null,"code":"var _jsxFileName = \"/Users/dmitrydrobysh/Desktop/SyncDir/code-ui/src/helpers/PrivateRoute.js\",\n  _s = $RefreshSig$();\n/* eslint-disable react/jsx-props-no-spreading */\nimport React, { useEffect, useState } from 'react';\nimport { Route, Redirect } from 'react-router-dom';\nimport Cookies from 'js-cookie';\nimport { useDispatch } from 'react-redux';\nimport axios from 'axios';\nimport { add, del } from '../actions/userActions';\nimport * as api from '../constants/api';\nimport Loader from '../components/loader/Loader';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PrivateRoute = ({\n  component: Component,\n  ...rest\n}) => {\n  _s();\n  const [user, setUser] = useState();\n  const [isLoading, setIsLoading] = useState(true);\n  const [isError, setIsError] = useState(false);\n  const dispatch = useDispatch();\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const res = await axios.get(api.getUser(), {\n          headers: {\n            Authorization: `cloudToken ${Cookies.get('token')}`\n          }\n        });\n        const userData = {\n          ...res.data,\n          roleId: 2\n        };\n        setUser(userData);\n        dispatch(add(userData));\n      } catch (error) {\n        setIsError(true);\n        setUser();\n        dispatch(del());\n        Cookies.remove('token');\n      }\n      setIsLoading(false);\n    };\n    fetchUser();\n  }, [dispatch]);\n\n  // TODO: redirect to login page if error found\n  if (isError) return /*#__PURE__*/_jsxDEV(Redirect, {\n    to: \"/\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 38,\n    columnNumber: 23\n  }, this);\n  if (isLoading) return /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 40,\n    columnNumber: 25\n  }, this);\n  return /*#__PURE__*/_jsxDEV(Route, {\n    ...rest,\n    render: props => user !== null ? /*#__PURE__*/_jsxDEV(Component, {\n      ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 63\n    }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 90\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 42,\n    columnNumber: 10\n  }, this);\n};\n_s(PrivateRoute, \"6dCyfkMjxJp+tISZlWo9+oBRffs=\", false, function () {\n  return [useDispatch];\n});\n_c = PrivateRoute;\nexport default PrivateRoute;\nvar _c;\n$RefreshReg$(_c, \"PrivateRoute\");","map":{"version":3,"names":["React","useEffect","useState","Route","Redirect","Cookies","useDispatch","axios","add","del","api","Loader","jsxDEV","_jsxDEV","PrivateRoute","component","Component","rest","_s","user","setUser","isLoading","setIsLoading","isError","setIsError","dispatch","fetchUser","res","get","getUser","headers","Authorization","userData","data","roleId","error","remove","to","fileName","_jsxFileName","lineNumber","columnNumber","render","props","_c","$RefreshReg$"],"sources":["/Users/dmitrydrobysh/Desktop/SyncDir/code-ui/src/helpers/PrivateRoute.js"],"sourcesContent":["/* eslint-disable react/jsx-props-no-spreading */\nimport React, { useEffect, useState } from 'react';\nimport { Route, Redirect } from 'react-router-dom';\nimport Cookies from 'js-cookie';\nimport { useDispatch } from 'react-redux';\nimport axios from 'axios';\nimport { add, del } from '../actions/userActions';\nimport * as api from '../constants/api';\nimport Loader from '../components/loader/Loader';\n\nconst PrivateRoute = ({ component: Component, ...rest }) => {\n  const [user, setUser] = useState();\n  const [isLoading, setIsLoading] = useState(true);\n  const [isError, setIsError] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const res = await axios.get(api.getUser(), {\n          headers: { Authorization: `cloudToken ${Cookies.get('token')}` },\n        });\n        const userData = { ...res.data, roleId: 2 };\n        setUser(userData);\n        dispatch(add(userData));\n      } catch (error) {\n        setIsError(true);\n        setUser();\n        dispatch(del());\n        Cookies.remove('token');\n      }\n      setIsLoading(false);\n    };\n    fetchUser();\n  }, [dispatch]);\n\n  // TODO: redirect to login page if error found\n  if (isError) return <Redirect to=\"/\" />;\n\n  if (isLoading) return <Loader />;\n\n  return <Route {...rest} render={(props) => (user !== null ? <Component {...props} /> : <Redirect to=\"/\" />)} />;\n};\n\nexport default PrivateRoute;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}