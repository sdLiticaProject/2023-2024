{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dmitrydrobysh/Desktop/sdlitica/code-ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/dmitrydrobysh/Desktop/sdlitica/code-ui/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/dmitrydrobysh/Desktop/sdlitica/code-ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/dmitrydrobysh/Desktop/sdlitica/code-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectWithoutProperties from\"/Users/dmitrydrobysh/Desktop/sdlitica/code-ui/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";var _excluded=[\"component\"];/* eslint-disable react/jsx-props-no-spreading */import React,{useEffect,useState}from'react';import{Route,Redirect}from'react-router-dom';import Cookies from'js-cookie';import{useDispatch}from'react-redux';import axios from'axios';import{add,del}from'../actions/userActions';import*as api from'../constants/api';import Loader from'../components/loader/Loader';import{jsx as _jsx}from\"react/jsx-runtime\";var PrivateRoute=function PrivateRoute(_ref){var Component=_ref.component,rest=_objectWithoutProperties(_ref,_excluded);var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isError=_useState6[0],setIsError=_useState6[1];var dispatch=useDispatch();useEffect(function(){var fetchUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res,userData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get(api.getUser(),{headers:{Authorization:\"cloudToken \".concat(Cookies.get('token'))}});case 3:res=_context.sent;userData=_objectSpread(_objectSpread({},res.data),{},{roleId:2});setUser(userData);dispatch(add(userData));_context.next=15;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);setIsError(true);setUser();dispatch(del());Cookies.remove('token');case 15:setIsLoading(false);case 16:case\"end\":return _context.stop();}},_callee,null,[[0,9]]);}));return function fetchUser(){return _ref2.apply(this,arguments);};}();fetchUser();},[dispatch]);// TODO: redirect to login page if error found\nif(isError)return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});if(isLoading)return/*#__PURE__*/_jsx(Loader,{});return/*#__PURE__*/_jsx(Route,_objectSpread(_objectSpread({},rest),{},{render:function render(props){return user!==null?/*#__PURE__*/_jsx(Component,_objectSpread({},props)):/*#__PURE__*/_jsx(Redirect,{to:\"/\"});}}));};export default PrivateRoute;","map":{"version":3,"names":["React","useEffect","useState","Route","Redirect","Cookies","useDispatch","axios","add","del","api","Loader","jsx","_jsx","PrivateRoute","_ref","Component","component","rest","_objectWithoutProperties","_excluded","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","isLoading","setIsLoading","_useState5","_useState6","isError","setIsError","dispatch","fetchUser","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","userData","wrap","_callee$","_context","prev","next","get","getUser","headers","Authorization","concat","sent","_objectSpread","data","roleId","t0","remove","stop","apply","arguments","to","render","props"],"sources":["/Users/dmitrydrobysh/Desktop/sdlitica/code-ui/src/helpers/PrivateRoute.js"],"sourcesContent":["/* eslint-disable react/jsx-props-no-spreading */\nimport React, { useEffect, useState } from 'react';\nimport { Route, Redirect } from 'react-router-dom';\nimport Cookies from 'js-cookie';\nimport { useDispatch } from 'react-redux';\nimport axios from 'axios';\nimport { add, del } from '../actions/userActions';\nimport * as api from '../constants/api';\nimport Loader from '../components/loader/Loader';\n\nconst PrivateRoute = ({ component: Component, ...rest }) => {\n  const [user, setUser] = useState();\n  const [isLoading, setIsLoading] = useState(true);\n  const [isError, setIsError] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const res = await axios.get(api.getUser(), {\n          headers: { Authorization: `cloudToken ${Cookies.get('token')}` },\n        });\n        const userData = { ...res.data, roleId: 2 };\n        setUser(userData);\n        dispatch(add(userData));\n      } catch (error) {\n        setIsError(true);\n        setUser();\n        dispatch(del());\n        Cookies.remove('token');\n      }\n      setIsLoading(false);\n    };\n    fetchUser();\n  }, [dispatch]);\n\n  // TODO: redirect to login page if error found\n  if (isError) return <Redirect to=\"/\" />;\n\n  if (isLoading) return <Loader />;\n\n  return <Route {...rest} render={(props) => (user !== null ? <Component {...props} /> : <Redirect to=\"/\" />)} />;\n};\n\nexport default PrivateRoute;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}